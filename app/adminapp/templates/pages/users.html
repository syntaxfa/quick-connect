{{define "users_page"}}
<div class="users-content">

    <div class="users-header">
        <div class="header-left">
            <h1 class="page-title">User Management</h1>
            <p class="page-subtitle">Manage and monitor all users</p>
        </div>

        <div class="header-actions">
            <button class="btn-primary" hx-get="/users/create" hx-target="#modal-container" hx-swap="innerHTML">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
                Add User
            </button>
        </div>
    </div>

    <div class="users-stats">
        <div class="stat-card">
            <div class="stat-card-icon total">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                </svg>
            </div>
            <div class="stat-card-content">
                <span class="stat-value">{{if .TotalUsers}}{{.TotalUsers}}{{else}}N/A{{end}}</span>
                <span class="stat-label">Total Users</span>
            </div>
        </div>
    </div>

    <form class="users-filters"
          hx-get="/users/list"
          hx-target="#user-list-content"
          hx-swap="innerHTML"
          hx-trigger="submit, keyup changed delay:500ms from:#user-search-input, change from:#user-sort-select, change from:.role-filter-checkbox"
    >

        <div class="search-box">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
            </svg>
            <input type="text"
                   id="user-search-input"
                   class="search-input"
                   placeholder="Search by username..."
                   name="username">
        </div>

        <select class="sort-select" name="sort_direction" id="user-sort-select">
            <option value="2">Newest First (DESC)</option> <option value="1">Oldest First (ASC)</option> </select>

        <div class="filter-dropdown">
            <button type="button" class="filter-btn" onclick="toggleRoleFilter(this)">
                <span>Filter by Role</span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 1rem; height: 1rem; margin-left: 0.5rem;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
            </button>
            <div class="filter-dropdown-content">
                {{range .AllRoles}}
                <label class="role-checkbox" for="filter-role-{{.Value}}">
                    <input
                            type="checkbox"
                            name="roles"
                            id="filter-role-{{.Value}}"
                            class="role-filter-checkbox"
                            value="{{.Name}}"
                    >
                    {{.Name}}
                </label>
                {{end}}
            </div>
        </div>
        <button type="submit" style="display: none;">Search</button>
    </form>

    <div id="user-list-content"
         hx-get="/users/list"
         hx-trigger="load, userListChanged from:body"
         hx-swap="innerHTML">

        <div style="display: flex; justify-content: center; padding: 4rem;">
            <span style="color: #94a3b8; font-size: 1rem; font-family: 'JetBrains Mono', monospace;">Loading users...</span>
        </div>
    </div>

</div>

<div id="modal-container"></div>
{{end}}