{{define "users_page"}}
<div class="users-content">

    <!-- Header Section with Actions -->
    <div class="users-header">
        <div class="header-left">
            <h1 class="page-title">User Management</h1>
            <p class="page-subtitle">Manage and monitor all users</p>
        </div>

        <div class="header-actions">
            <!--
                TODO: Export button needs a separate handler
            <button class="btn-secondary" hx-get="/users/export" hx-swap="none">
                <svg ...>...</svg>
                Export
            </button>
            -->
            <button class="btn-primary" hx-get="/users/create" hx-target="#modal-container" hx-swap="innerHTML">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
                Add User
            </button>
        </div>
    </div>

    <!-- Stats Cards - Only Total Users is supported by the API -->
    <div class="users-stats">
        <div class="stat-card">
            <div class="stat-card-icon total">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                </svg>
            </div>
            <div class="stat-card-content">
                <!-- This value should be passed by the ShowUsersPage handler -->
                <!--
                  FIX: Use 'if' for conditional rendering.
                  This checks if .TotalUsers exists and is not a zero value (0, false, nil, "").
                -->
                <span class="stat-value">{{if .TotalUsers}}{{.TotalUsers}}{{else}}N/A{{end}}</span>
                <span class="stat-label">Total Users</span>
            </div>
        </div>
        <!-- Other stat cards were removed as the API doesn't support them -->
    </div>

    <!-- Filters and Search Form -->
    <!--
      This form builds the UserListRequest parameters
      and loads the result into #user-list-content
    -->
    <form class="users-filters"
          hx-get="/users/list"
          hx-target="#user-list-content"
          hx-swap="innerHTML"
          hx-trigger="submit, keyup changed delay:500ms from:#user-search-input, change from:#user-sort-select">

        <div class="search-box">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
            </svg>
            <input type="text"
                   id="user-search-input"
                   class="search-input"
                   placeholder="Search by username..."
                   name="username">
        </div>

        <!-- Filter buttons removed -->

        <select class="sort-select" name="sort_direction" id="user-sort-select">
            <!-- Value maps directly to Proto Enum -->
            <option value="2">Newest First (DESC)</option> <!-- 2 = SORT_DIRECTION_DESC -->
            <option value="1">Oldest First (ASC)</option> <!-- 1 = SORT_DIRECTION_ASC -->
        </select>

        <!-- This button is hidden and only used for submitting the form with Enter -->
        <button type="submit" style="display: none;">Search</button>
    </form>

    <!--
      Dynamic content (table and pagination)
      This section automatically fetches content from /users/list on page load
    -->
    <div id="user-list-content"
         hx-get="/users/list"
         hx-trigger="load, userListChanged from:body"
         hx-swap="innerHTML">

        <!-- Display a simple loader until content is loaded -->
        <div style="display: flex; justify-content: center; padding: 4rem;">
            <span style="color: #94a3b8; font-size: 1rem; font-family: 'JetBrains Mono', monospace;">Loading users...</span>
        </div>
    </div>

</div>

<!-- Modal Container for Add/Edit User -->
<div id="modal-container"></div>
{{end}}