{{define "users_list_partial"}}
<!--
  This file contains the table and pagination.
  The Go handler must pass a struct containing two fields:
  .Users      (slice of User)
  .Pagination (struct with pagination data)
-->

<!-- Users Table -->
<div class="users-table-container" style="animation: fadeInUp 0.4s ease;">
    <table class="users-table">
        <thead>
        <tr>
            <!-- Checkbox column removed -->
            <th>User</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Last Online</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="users-table-body">

        {{range .Users}}
        <!-- User Row -->
        <tr class="user-row" id="user-row-{{.ID}}">

            <!--
              ADD: data-label attributes for responsiveness
            -->

            <td data-label="User">
                <!-- User cell: Avatar, Fullname, Username -->
                <div class="user-cell">
                    <div class="user-avatar" style="background: linear-gradient(135deg, #06b6d4, #8b5cf6);">
                        {{if .Avatar}}
                        <img src="{{.Avatar}}" alt="{{.Fullname}}" style="width:100%; height:100%; object-fit: cover;">
                        {{else}}
                        <!-- Placeholder: First two initials of Fullname -->
                        <span>{{.Fullname | initials}}</span>
                        {{end}}
                    </div>
                    <div class="user-info">
                        <span class="user-name">{{.Fullname}}</span>
                        <span class="user-id">@{{.Username}}</span>
                    </div>
                </div>
            </td>
            <td data-label="Email">
                <span class="user-email">{{.Email}}</span>
            </td>
            <td data-label="Phone">
                <span class="user-date">{{if .PhoneNumber}}{{.PhoneNumber}}{{else}}-{{end}}</span>
            </td>
            <td data-label="Last Online">
                <!--
                  The Go handler must send .LastOnlineAt as a formatted string
                -->
                <span class="user-date">{{if .LastOnlineAt}}{{.LastOnlineAt}}{{else}}Never{{end}}</span>
            </td>
            <td data-label="Actions">
                <!-- Buttons: TODO - Replace links with appropriate hx-get routes -->
                <div class="action-buttons">
                    <button class="action-btn view" title="View Details"
                            hx-get="/users/{{.ID}}/details" hx-target="#modal-container">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                    <button class="action-btn edit" title="Edit User"
                            hx-get="/users/{{.ID}}/edit" hx-target="#modal-container">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                    </button>
                    <button class="action-btn delete" title="Delete User"
                            hx-get="/users/delete/confirm?id={{.ID}}&username={{.Username}}"
                            hx-target="#modal-container"
                            hx-swap="innerHTML">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                    </button>
                </div>
            </td>
        </tr>
        {{else}}
        <!-- Empty state: If no users are found -->
        <tr>
            <!-- Colspan updated from 6 to 5 -->
            <td colspan="5" style="text-align: center; padding: 2rem; color: #94a3b8;">
                No users found matching your criteria.
            </td>
        </tr>
        {{end}}

        </tbody>
    </table>
</div>

<!-- Pagination (Dynamic based on .Pagination) -->
<!-- ... (pagination code remains the same) ... -->
<div class="pagination" style="animation: fadeInUp 0.4s ease 0.1s backwards;">
    <div class="pagination-info">
        <!-- .Pagination.TotalNumber from UserListResponse -->
        Showing <span class="font-semibold">{{len .Users}}</span> of <span class="font-semibold">{{.Pagination.TotalNumber}}</span> users
    </div>
    <div class="pagination-controls">

        <!-- "Previous" button -->
        <button class="pagination-btn"
                {{if .Pagination.HasPrev}}
                hx-get="{{.Pagination.BaseURL}}?page={{.Pagination.PrevPage}}&username={{.Pagination.Query}}&sort_direction={{.Pagination.SortDirection}}"
                hx-target="#user-list-content"
                hx-swap="innerHTML"
                {{else}}
                disabled
                {{end}}>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
            </svg>
        </button>

        <!-- Page number buttons (simplified logic) -->
        {{range .Pagination.Pages}}
        <button class="pagination-btn {{if .IsCurrent}}active{{end}}"
                hx-get="{{.URL}}"
                hx-target="#user-list-content"
                hx-swap="innerHTML">
            {{.PageNumber}}
        </button>
        {{end}}

        <!-- "Next" button -->
        <button class="pagination-btn"
                {{if .Pagination.HasNext}}
                hx-get="{{.Pagination.BaseURL}}?page={{.Pagination.NextPage}}&username={{.Pagination.Query}}&sort_direction={{.Pagination.SortDirection}}"
                hx-target="#user-list-content"
                hx-swap="innerHTML"
                {{else}}
                disabled
                {{end}}>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
            </svg>
        </button>
    </div>
</div>
{{end}}